JavaScript中的Date很奇怪.当我们需要处理日期和时间比较麻烦,经常借助`date-fns`和`moment`这样的库.

但我们并不总需要这样的库.如果知道注意上些问题,日期实际上可以非常简单.

---

## **时区**

我们的世界有数百个时区,在JavaScript中,我们只关心两个,本地时间和协调时间(utc).

- 本地时间是指你的计算机所在的地区.
- UTC实际上是格林威治标准时间(GMT)的同义词

默认情况下,JavaScript中几乎每个日期方法(除了了一个)都是本地时间.只有指定UTC,才能获得UTC时间.

---

## **创建日期**

可以使用`new Date()`来创建日期,传入的参数通常有4种方式:

1. 使用日期字符串参数
2. 使用一系列的参数
3. 时间戳参数
4. 不带参数

### **使用日期字符串参数**

```
new Date('1988-03-21')
```

这种方式方便且直观

如果现在写的是`20-03-1988`,我们可以这不费力想表达的是1988年3月21日.但是如果JavaScript编写`21-03-1988`,则会得到无效日期.

```
new Date('21-03-1988')
// Invalid Date
```

这是有原因的.

在世界的不同地方以不同的方式解释日期字符串.例如`11-06-2019`是2019年6月11日,还是2019年11月6日.你不能确定我指的是哪一个,除非你知道我正在使用的日期系统.

在JavaScript中,如果要使用日期字符串,则需要使用全球都能接受的格式,其中一种模式是[ISO 8601扩展格式](https://en.wikipedia.org/wiki/ISO_8601).

```
// ISO 8601 Extended format
YYYY-MM-DDTHH:mm:ss:sssZ
```

- `YYYY`: 4位数年份
- `MM`: 两位数月份(即1月为01,12月为12)
- `DD`: 两位数的日期(0到31)
- `-`: 日期分隔符
- `T`: 表示开始时间
- `HH`: 24位小时数(0到23)
- `mm`: 分钟(0到59)
- `ss`: 秒(0到59)
- `sss`: 毫秒(0到999)
- `:`: 时间分隔符
- `Z`: 如果存在`Z`,则日期将设置为UTC,如果
`Z`不存在,则为本地时间

其中小时,分钟,秒和毫秒是可选的,如果你想创建一个2019年6月11日的日期可以这样写:

```
new Date('2019-05-11')
```

在这里要特别注意,使用日期字符串参数创建日期存在很在问题,在创建的日期打印出来就可以发现问题

如果你在格林威治标准时间(GMT)地区,你会得到一个日期是6月10日

```
new Date('2019-06-11')
// Date Mon Jun 10 2019 17:00:00 GMT-0700 (Pacific Daylight Time)
```

如果你住在比格林威治标准时间早的地区,才会得到6月11日的日期.

```
new Date('2019-06-11')
// Date Tue Jun 11 2019 08:00:00 GMT_0800 (Singapore Standard Time)
```

发生这种情况是因为日期字符串的方法具有特殊行为,如果创建日期(未指定时间),则会获得UTC格式设置的日期.

在上面的场景中,使用`new Date('2019-06-11')创建日期,实际上创建的日期是2019年6月11日,UTC时间上午12点,这就是为什么住在格林尼治标准时间之后的地区的人得到的是6月10日而不是6月11日.

如果要使用日期字符串参数方法在本地时间中伊娃日期,则需要包括时间.如果包含时间,则需要至少写入`HH`和`mm`

```
new Date('2019-06-11T00:00')
```

伤脑筋日期字符串参数的创建的本地时间与UTC的比较可能是一个难以捕捉的错误.所以建议不要使用日期字符串创建日期方式

> **格林威治标准时间GMT** 格林威治天文台为了海上霸权的扩张文韬武略而进行天体观测.1675年旧观测所正式成立,到2884年决定以通过格林威治的子午线作为划分地球东西两个半球的经度零度.观测所门口墙上有一个标志24小时的时钟,显示当下的时间,对全球而言,这里所设定的时间是世界时间的参考点,全球都以格林威治的时间作为标准来设定时间.

> **世界协调时间UTC** 多数的两地时间表都以GMT来表示，但也有些两地时间表上看不到GMT字样，出现的反而是UTC这3个英文字母，究竟何谓UTC？事实上，UTC指的是Coordinated Universal Time－ 世界协调时间（又称世界标准时间、世界统一时间），是经过平均太阳时(以格林威治时间GMT为准)、地轴运动修正后的新时标以及以「秒」为单位的国际原子时所综合精算而成的时间，计算过程相当严谨精密，因此若以「世界标准时间」的角度来说，UTC比GMT来得更加精准。其误差值必须保持在0.9秒以内，若大于0.9秒则由位于巴黎的国际地球自转事务中央局发布闰秒，使UTC与地球自转周期一致。所以基本上UTC的本质强调的是比GMT更为精确的世界时间标准，不过对于现行表款来说，GMT与UTC的功能与精确度是没有差别的

### **使用一系列的参数创建**

最多可以传入七个参数来创建日期/时间

1. Year: 4位数年份
2. Month: 一年中的某月(0-11)
3. Day: 每月的某天(1-31),如果省略,则默认为1
4. Hour: 一天中的小时(0-23),如果省略,则默认为0
5. Minutes: 分钟(0-59),如果省略,则默认为0
6. Seconds: 秒(0-59),如果省略,则默认为0
7. Millseconds: 毫秒(0-999),如果省略,则默认为0

```
11th June 2019, 5:23:59am, Local Time new Date(2019, 5, 11, 5, 23, 59)
```

许多开发人员比较少用这种方式,因为它看起来很复杂,但它实际上非常简单.可以从打卡到右记忆:年,月,日,小时,分钟,秒和毫秒.

Date中需要注意的地方Month是从0开始的,如`1月====0`,`2月====1`,`3月====2`,依此类推.

> 注意, 使用参数创建的日期都是用本地时间

使用参数的还有一个好处是不会在本地暗和UTC之间混淆,如果需要UTC时间,请以这种方式创建UTC时间

```
// 11th June 2019, 12am, UTC.
new Date(Date.UTC(2019,5,11))
```

### **使用时间戳来创建日期**

在JavaScript中,时间戳是自1970年1月1日以来经过的毫秒来创建日期,一般使用时间戳来比较不同的日期或格式化日期.

### **不带参数的形式创建日期**

如果创建没有任何参数的日期,则会将日期设置为当前时间(以本地时间为单位)

```
new Date()
// Fri Jun 28 2019 10:09:43 GMT+0800 (中国标准时间)
```

### **小结**

1. 使用`new Date()`创建日期
2. 有四种可能的语法:  
    - 使用字段串
    - 使用一系列参数
    - 使用时间戳
    - 不带参数
3. 最好不要使用字符串日期值的方法创建日期
4. 最好使用一系列参数方式创建日期
5. 记住月份是从0开始

---

## **格式化日期**

多数编程语言都提供了一种格式工具来创建你想要的任何格式日期,例如在php中,可以将`date('d M Y')`格式化为`23 1月 2019`这样的日期.

但是在js中格式化日期并不容易

原生`Date`对象提供了七种格式化方法,这七种方法中的每上种都会给你一个特定的值,而它们毫无用处.

```
const date = new Date(2019,0,23,17,23,42)
```

1. `toString`: 格式化成`Wed Jan 23 2019 17:23:42 GMT+0800 (中国标准时间)`
2. `toDateString`: 格式化成`Web Jan 23 2019`
3. `toLocaleString`: 格式化成`2019/1/23 下午5:23:42`
4. `toLocaleDateString`: 格式化为`2019/1/23`
5. `toGMTString`: 格式化成`Web,23 Jan 2019 09:23:42 GMT`
6.`toUTCString`: 格式化成`Wed, 23 Jan 2019 09:23:42 GMT`
7. `toISOString`: 格式化成`2019-01-23T09:23:42.000Z`

如果需要自己定义格式,则需要自己创建.

### **编写自定义日期格式**

假设想要`2019年1月23日 星期四`这样的日期格式.需要知道`Date`对象日期对象.

要获得这样的格式,用到Date中的四个方法:

1. `getFullYear`: 获取当地时间4位数的年份
2. `getMonth`: 获取当前时间的月份,注意是从0开始
3. `getDate`: 获取当地时间月中的某一天(1-31)
4. `getDay`: 获取当地时间的星期几(0-6),星期日(0)开始,到星期六(6)结束.

```
const d = new Date(2019,0,23)
const year = d.getFullYear()  //2019
const date = d.getDate()  //23
```

### ***如果需要创建自定义格式的时间,可以使用以下方法

1. `getHours`: 获取当地时间获取小时数(0-23)
2. `getMinutes`: 获取本地时间获取分钟(0-59)
3. `getSeconds`: 获取本地时间获取秒数(0-59)
4. `getMilliseconds`: 获取本地时间获取毫秒数(0-999)

---

## **日期的比较**

比较日期的前后,可以直接使用`>` , `<`, `>=` 的 `<=`进行比较.

```
const earlier = new Date(2019,0,26)
const later = new Date(2019,0,27)

console.log(earlier < later)
// true
```

比较两个日期是否一样,就比较麻烦,不能直接用`==` 或 `===`

```
const a = new Date(2019,0,26)
const b = new Date(2019,0,26)

console.log(a == b) //false
console.log(a ===b )  //false
```

可以使用`getTime()`获取它们的时间戳,用时间戳进行比较

```
const isSameTime = (a,b) => {
  return a.getTime() === b.getTime()
}

const a = new Date(2019,0,26)
const b = new Date(2019,0,26)
console.log(isSameTime(a,b))  //true
```

如果只想检查两个日期是否是同一天,可以比较他们的`getFullYear`,`getMonth`和`getDate`值

```
const isSameDay = (a,b) => {
  return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === a.getDate()
} 

const a = new Date(2019, 0, 26, 10) // 26 Jan 2019, 10am
const b = new Date(2019, 0, 26, 12) // 26 Jan 2019, 12pm
console.log(isSameDay(a, b)) // true
```

---

## **从另一个日期获取日期**

有两种可能情况,希望从另一个日期获得一个日期

1. 设置另一个日期特定的日期/时间值
2. 从另一个日期添加/减去值

可以使用以下方法设置另一个日期的日期/时间:

- `setFullYear`: 设置年份
- `setMonth`: 设置月份
- `setDate`: 设置每月的某一天
- `setHours`: 设置时
- `setMinutes`: 设置分
- `setSeconds`: 设置秒
- `setMilliseconds`: 设置毫秒

例如,想将日期设置为每月15日,可以使用`setDate(15)`

```
const d = new Date(2019,0,10)
d.setDate(15)

console.log(d)  // 15 January 2019
```

> 注意: 上面的`setter`方法会改变原始日期对象.在实际中,我们不应该改变对象,应该在新的日期对象上执行这些操作.

```
const d = new Date(2019,0,10)
const newDate = new Date(d)
newDate.setMonth(5)

console.log(d) // 10 January 2019
console.log(newDate) // 10 June 2019
```

### **w从另一个日期添加/减去增量**

添加/减去增量有两种方法.第一种在Stack Overflow上更受欢迎,它简洁,但更难掌握,第二种方法更冗长,但更容易理解.

假设希望获得从今天起三天的日期.对于这个例子,假设今天是2019年3月28日

**第一种方法**

```
const today = new Date(2019,2,28)
```

首先,我们创建一个新的Date对象,这样就不会改变原始日期

```
const finalDate = new Date(today)
```

接下来,我们需要知道要更改的值,因为我们要改变日期,所以我们可以用`getDate`获得日期

```
const currentDate - to.getDate()
```

因为获取三天后的日期,所以需要在得到的日期加3

```
setDate(currentDate + 3)
```

完整代码

```
const today = new Date(2019,2,28)
const finalDate = new Date(today)
finalDate.setDate(today.getDate() + 3)
```

**第二种方法**

使用`getFullYear`,`getMonth`,`getDate`方法,更改对应值,然后我们使用`new Date`创建最终日期.

```
const today = new Date(2019,2,28)

// Getting required values
const year = today.getFullYear()
const month - today.getMonth()
const day = today.getDate()

// Creating a new Date(with the delta)
const filanDate = new Date(year,month,day + 3)

console.log(finalDate)  // 31 March 2019
```

---

## **自动日期校正**

如果为Date提供一个走出其可接受范围的值,JavaScript将自动重新计算日期

假设我们把日期设定在2019年3月33日,日历上没有33日,JavaScript会自动将3月33日调整为4月2日.

这意味着在创建增量时无需担心计算分钟,小时,天,月等,JavaScript会自动处理.